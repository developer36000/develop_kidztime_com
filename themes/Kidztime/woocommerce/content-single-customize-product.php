<?php
/**
 * The template for displaying product content in the single-product.php template
 *
 * This template can be overridden by copying it to yourtheme/woocommerce/content-single-product.php.
 *
 * HOWEVER, on occasion WooCommerce will need to update template files and you
 * (the theme developer) will need to copy the new files to your theme to
 * maintain compatibility. We try to do this as little as possible, but it does
 * happen. When this occurs the version of the template file will be bumped and
 * the readme will list any important changes.
 *
 * @see     https://docs.woocommerce.com/document/template-structure/
 * @package WooCommerce/Templates
 * @version 3.6.0
 */

defined( 'ABSPATH' ) || exit;
$is_new_product = isset($_GET['new_product']) ? $_GET['new_product'] : '';
$is_edit_product = isset($_GET['edit_product']) ? $_GET['edit_product'] : '';

global $product;

$product_id = $product->get_id();
$product_attributes = $product->get_attributes();

$main_customize_img = get_field('main_customize_img',  $product_id);
$real_product_width_mm = get_field('real_product_width',  $product_id); // mm
$real_product_height_mm = get_field('real_product_height',  $product_id); // mm
$real_width_print_mm = get_field('real_product_width_print',  $product_id); // mm
$real_height_print_mm = get_field('real_product_height_print',  $product_id); // mm
$is_bottle  = get_field('is_bottle ',  $product_id); // mm

$real_product_width = convert_mm_to_px($real_product_width_mm); // px
$real_product_height = convert_mm_to_px($real_product_height_mm); // px

$canvas_width_print = convert_mm_to_px($real_width_print_mm); // px
$canvas_height_print = convert_mm_to_px($real_height_print_mm); // px

$scaleRatio = get_post_meta( $product_id, '_scaleRatio_coord_real', true );
$r_rect_obg = get_post_meta( $product_id, '_rect_obg_coord_real', true );

echo '<pre>';
var_dump( '$is_new_product', $is_new_product );
var_dump( '$is_edit_product', $is_edit_product );
echo '</pre>';

do_action( 'woocommerce_before_single_product' );

if ( post_password_required() ) {
	echo get_the_password_form(); // WPCS: XSS ok.
	return;
}

?>
<?php do_action( 'ktwc_before_customize_product' ); ?>

<article class="single-product-customize">


	<div class="customizer-wrapper">
		<div class="overlay"></div>
		<div class="customizer-container">
			<div class="left-side">
				<div class="attribute-top-navigation">
					<a href="#cta_modal_close_product_go_back" class="attribute-back-btn ktwoo-cta"
					   data-product_id="<?php echo $product_id; ?>" >
						<svg width="24" height="16" viewBox="0 0 24 16" fill="#58448B" xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd" clip-rule="evenodd" d="M7.29289 0.292893C7.68342 -0.0976311 8.31658 -0.0976311 8.70711 0.292893C9.09763 0.683418 9.09763 1.31658 8.70711 1.70711L3.41421 7L23 7C23.5523 7 24 7.44772 24 8C24 8.55229 23.5523 9 23 9L3.41421 9L8.70711 14.2929C9.09763 14.6834 9.09763 15.3166 8.70711 15.7071C8.31658 16.0976 7.68342 16.0976 7.29289 15.7071L0.292894 8.70711C-0.0976312 8.31658 -0.0976312 7.68342 0.292894 7.29289L7.29289 0.292893Z" fill="inherit"/>
						</svg>
					</a>
					<div class="steps-nav">
						<a href="#" class="attr-prev-step">
							<svg width="28" height="28" viewBox="0 0 28 28" fill="#C8C8C8" xmlns="http://www.w3.org/2000/svg">
								<path fill-rule="evenodd" clip-rule="evenodd" d="M0.299219 13.9998C0.299219 6.44252 6.44193 0.299805 13.9992 0.299805C21.5468 0.299805 27.6895 6.44252 27.6992 13.9998C27.6992 21.5571 21.5565 27.6998 13.9992 27.6998C6.44193 27.6998 0.299219 21.5571 0.299219 13.9998ZM2.3145 13.9901C2.3145 20.4332 7.55615 25.6748 13.9992 25.6748C20.4326 25.6748 25.6743 20.4332 25.6839 13.9901C25.6839 7.54705 20.4423 2.30539 13.9992 2.30539C7.55615 2.30539 2.3145 7.54705 2.3145 13.9901ZM8.81558 12.139H18.2234C19.1729 12.139 20.0643 12.5072 20.7328 13.1757C21.4014 13.8442 21.7695 14.7356 21.7695 15.6851C21.7695 16.6249 21.3917 17.5357 20.7328 18.1945C20.0643 18.863 19.1729 19.2312 18.2234 19.2312C17.6712 19.2312 17.2158 18.7758 17.2158 18.2236C17.2158 17.6713 17.6615 17.2159 18.2234 17.2159C18.64 17.2159 19.0179 17.0609 19.3086 16.7702C19.5896 16.4796 19.7543 16.092 19.7543 15.6851C19.7543 15.2782 19.5992 14.8906 19.3086 14.5999C19.0179 14.3093 18.6304 14.1543 18.2234 14.1543H8.80589L10.4821 15.8014C10.8793 16.1889 10.8793 16.8284 10.4821 17.2256C10.2786 17.4194 10.0267 17.5163 9.76508 17.5163C9.50348 17.5163 9.24189 17.4194 9.04811 17.2256L5.66671 13.8442C5.57951 13.7667 5.53107 13.6698 5.48263 13.5729L5.48262 13.5729C5.47778 13.5632 5.47051 13.556 5.46325 13.5487C5.45598 13.5414 5.44871 13.5342 5.44387 13.5245C5.39542 13.4082 5.36636 13.2726 5.36636 13.1369C5.36636 13.1176 5.3712 13.1006 5.37605 13.0836C5.38089 13.0667 5.38573 13.0497 5.38573 13.0304L5.38673 13.0214C5.39612 12.9365 5.40644 12.8433 5.44387 12.7591C5.502 12.6331 5.57951 12.5168 5.6764 12.42L9.04811 9.04825C9.43566 8.65101 10.0751 8.65101 10.4724 9.04825C10.8696 9.4358 10.8696 10.0753 10.4724 10.4725L8.81558 12.139Z" fill="inherit"/>
							</svg>
						</a>
						<a href="#" class="attr-next-step">
							<svg width="28" height="28" viewBox="0 0 28 28" fill="#C8C8C8" xmlns="http://www.w3.org/2000/svg">
								<path fill-rule="evenodd" clip-rule="evenodd" d="M27.7008 13.9998C27.7008 6.44252 21.5581 0.299805 14.0008 0.299805C6.45319 0.299805 0.310471 6.44252 0.300781 13.9998C0.300781 21.5571 6.4435 27.6998 14.0008 27.6998C21.5581 27.6998 27.7008 21.5571 27.7008 13.9998ZM25.6855 13.9901C25.6855 20.4332 20.4439 25.6748 14.0008 25.6748C7.5674 25.6748 2.32575 20.4332 2.31606 13.9901C2.31606 7.54705 7.55771 2.30539 14.0008 2.30539C20.4439 2.30539 25.6855 7.54705 25.6855 13.9901ZM19.1844 12.139H9.77657C8.82707 12.139 7.9357 12.5072 7.26717 13.1757C6.59864 13.8442 6.23046 14.7356 6.23046 15.6851C6.23046 16.6249 6.60833 17.5357 7.26717 18.1945C7.9357 18.863 8.82707 19.2312 9.77657 19.2312C10.3288 19.2312 10.7842 18.7758 10.7842 18.2236C10.7842 17.6713 10.3385 17.2159 9.77657 17.2159C9.35995 17.2159 8.98209 17.0609 8.69142 16.7702C8.41045 16.4796 8.24574 16.092 8.24574 15.6851C8.24574 15.2782 8.40076 14.8906 8.69142 14.5999C8.98209 14.3093 9.36964 14.1543 9.77657 14.1543H19.1941L17.5179 15.8014C17.1207 16.1889 17.1207 16.8284 17.5179 17.2256C17.7214 17.4194 17.9733 17.5163 18.2349 17.5163C18.4965 17.5163 18.7581 17.4194 18.9519 17.2256L22.3333 13.8442C22.4205 13.7667 22.4689 13.6698 22.5174 13.5729L22.5174 13.5729C22.5222 13.5632 22.5295 13.556 22.5368 13.5487C22.544 13.5414 22.5513 13.5342 22.5561 13.5245C22.6046 13.4082 22.6336 13.2726 22.6336 13.1369C22.6336 13.1176 22.6288 13.1006 22.624 13.0836C22.6191 13.0667 22.6143 13.0497 22.6143 13.0304L22.6133 13.0214C22.6039 12.9365 22.5936 12.8433 22.5561 12.7591C22.498 12.6331 22.4205 12.5168 22.3236 12.42L18.9519 9.04825C18.5643 8.65101 17.9249 8.65101 17.5276 9.04825C17.1304 9.4358 17.1304 10.0753 17.5276 10.4725L19.1844 12.139Z" fill="inherit"/>
							</svg>
						</a>
					</div>
					<a href="#cta_modal_create_product_title" class="attribute-done-btn ktwoo-cta"
					   data-product_id="<?php echo $product_id; ?>">
						<svg width="76" height="28" viewBox="0 0 76 28" fill="#58448B" xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd" clip-rule="evenodd" d="M11.6499 3.58843C13.8936 3.08152 16.2409 3.31344 18.342 4.24961C18.8465 4.47439 19.4376 4.24766 19.6624 3.74318C19.8872 3.23871 19.6605 2.64754 19.156 2.42276C16.661 1.31105 13.8735 1.03564 11.2092 1.63761C8.54485 2.23957 6.1465 3.68666 4.37181 5.76305C2.59711 7.83944 1.54116 10.4339 1.36144 13.1594C1.18172 15.885 1.88786 18.5956 3.37453 20.887C4.86121 23.1785 7.04878 24.928 9.61098 25.8746C12.1732 26.8212 14.9727 26.9142 17.5921 26.1397C20.2115 25.3652 22.5103 23.7648 24.1458 21.5771C25.7813 19.3893 26.6658 16.731 26.6673 13.9995V12.9262C26.6673 12.3739 26.2196 11.9262 25.6673 11.9262C25.115 11.9262 24.6673 12.3739 24.6673 12.9262V13.9995C24.6659 16.2995 23.9211 18.5374 22.5439 20.3796C21.1667 22.2219 19.2308 23.5696 17.025 24.2218C14.8192 24.874 12.4617 24.7956 10.3041 23.9985C8.14644 23.2014 6.30428 21.7281 5.05234 19.7985C3.8004 17.8688 3.20576 15.5862 3.35711 13.291C3.50845 10.9958 4.39767 8.81103 5.89215 7.06249C7.38663 5.31395 9.40629 4.09535 11.6499 3.58843ZM26.3747 5.37301C26.7651 4.98229 26.7648 4.34913 26.374 3.9588C25.9833 3.56847 25.3501 3.56879 24.9598 3.95951L20.8335 8.08999L14.0003 14.93L11.2077 12.1375C10.8172 11.747 10.184 11.747 9.7935 12.1375C9.40298 12.528 9.40298 13.1612 9.7935 13.5517L13.2935 17.0517C13.4811 17.2393 13.7356 17.3447 14.0009 17.3446C14.2662 17.3445 14.5206 17.239 14.7081 17.0513L21.9465 9.80566L26.3747 5.37301Z" fill="inherit"/>
							<path d="M39.5081 18.336C39.6254 18.3467 39.7801 18.3573 39.9721 18.368C40.1641 18.368 40.4254 18.368 40.7561 18.368C42.1107 18.368 43.1187 18.0267 43.7801 17.344C44.4521 16.6507 44.7881 15.6853 44.7881 14.448C44.7881 13.1893 44.4627 12.224 43.8121 11.552C43.1614 10.88 42.1534 10.544 40.7881 10.544C40.1907 10.544 39.7641 10.56 39.5081 10.592V18.336ZM46.9001 14.448C46.9001 15.408 46.7507 16.2453 46.4521 16.96C46.1534 17.664 45.7267 18.256 45.1721 18.736C44.6281 19.2053 43.9667 19.5573 43.1881 19.792C42.4201 20.016 41.5667 20.128 40.6281 20.128C40.1801 20.128 39.6734 20.1067 39.1081 20.064C38.5427 20.032 38.0041 19.9573 37.4921 19.84V9.072C38.0041 8.95467 38.5481 8.88 39.1241 8.848C39.7001 8.816 40.2121 8.8 40.6601 8.8C41.5881 8.8 42.4361 8.912 43.2041 9.136C43.9721 9.34933 44.6281 9.69067 45.1721 10.16C45.7267 10.6187 46.1534 11.2053 46.4521 11.92C46.7507 12.624 46.9001 13.4667 46.9001 14.448ZM56.5734 15.808C56.5734 16.4693 56.4774 17.072 56.2854 17.616C56.0934 18.16 55.8214 18.624 55.4694 19.008C55.1174 19.392 54.6908 19.6907 54.1894 19.904C53.6988 20.1173 53.1548 20.224 52.5574 20.224C51.9601 20.224 51.4161 20.1173 50.9254 19.904C50.4348 19.6907 50.0134 19.392 49.6614 19.008C49.3094 18.624 49.0321 18.16 48.8294 17.616C48.6374 17.072 48.5414 16.4693 48.5414 15.808C48.5414 15.1467 48.6374 14.5493 48.8294 14.016C49.0321 13.472 49.3094 13.008 49.6614 12.624C50.0241 12.24 50.4508 11.9467 50.9414 11.744C51.4321 11.5307 51.9708 11.424 52.5574 11.424C53.1441 11.424 53.6828 11.5307 54.1734 11.744C54.6748 11.9467 55.1014 12.24 55.4534 12.624C55.8054 13.008 56.0774 13.472 56.2694 14.016C56.4721 14.5493 56.5734 15.1467 56.5734 15.808ZM54.5894 15.808C54.5894 14.976 54.4081 14.32 54.0454 13.84C53.6934 13.3493 53.1974 13.104 52.5574 13.104C51.9174 13.104 51.4161 13.3493 51.0534 13.84C50.7014 14.32 50.5254 14.976 50.5254 15.808C50.5254 16.6507 50.7014 17.3173 51.0534 17.808C51.4161 18.2987 51.9174 18.544 52.5574 18.544C53.1974 18.544 53.6934 18.2987 54.0454 17.808C54.4081 17.3173 54.5894 16.6507 54.5894 15.808ZM58.5679 11.904C58.9413 11.7973 59.4266 11.696 60.0239 11.6C60.6213 11.504 61.2826 11.456 62.0079 11.456C62.6906 11.456 63.2613 11.552 63.7199 11.744C64.1786 11.9253 64.5413 12.1867 64.8079 12.528C65.0853 12.8587 65.2773 13.264 65.3839 13.744C65.5013 14.2133 65.5599 14.7307 65.5599 15.296V20H63.6239V15.6C63.6239 15.152 63.5919 14.7733 63.5279 14.464C63.4746 14.144 63.3786 13.888 63.2399 13.696C63.1119 13.4933 62.9306 13.3493 62.6959 13.264C62.4719 13.168 62.1946 13.12 61.8639 13.12C61.6186 13.12 61.3626 13.136 61.0959 13.168C60.8293 13.2 60.6319 13.2267 60.5039 13.248V20H58.5679V11.904ZM67.4633 15.856C67.4633 15.12 67.57 14.4747 67.7833 13.92C68.0073 13.3653 68.3006 12.9067 68.6633 12.544C69.026 12.1707 69.442 11.8933 69.9113 11.712C70.3806 11.52 70.8606 11.424 71.3513 11.424C72.5033 11.424 73.3993 11.7813 74.0393 12.496C74.69 13.2107 75.0153 14.2773 75.0153 15.696C75.0153 15.8027 75.01 15.9253 74.9993 16.064C74.9993 16.192 74.994 16.3093 74.9833 16.416H69.4633C69.5166 17.088 69.7513 17.6107 70.1673 17.984C70.594 18.3467 71.2073 18.528 72.0073 18.528C72.4766 18.528 72.9033 18.4853 73.2873 18.4C73.682 18.3147 73.9913 18.224 74.2153 18.128L74.4713 19.712C74.3646 19.7653 74.2153 19.824 74.0233 19.888C73.842 19.9413 73.6286 19.9893 73.3833 20.032C73.1486 20.0853 72.8926 20.128 72.6153 20.16C72.338 20.192 72.0553 20.208 71.7673 20.208C71.0313 20.208 70.3913 20.1013 69.8473 19.888C69.3033 19.664 68.8553 19.36 68.5033 18.976C68.1513 18.5813 67.89 18.1227 67.7193 17.6C67.5486 17.0667 67.4633 16.4853 67.4633 15.856ZM73.0793 14.992C73.0793 14.7253 73.042 14.4747 72.9673 14.24C72.8926 13.9947 72.7806 13.7867 72.6313 13.616C72.4926 13.4347 72.3166 13.296 72.1033 13.2C71.9006 13.0933 71.6553 13.04 71.3673 13.04C71.0686 13.04 70.8073 13.0987 70.5833 13.216C70.3593 13.3227 70.1673 13.4667 70.0073 13.648C69.858 13.8293 69.7406 14.0373 69.6553 14.272C69.57 14.5067 69.5113 14.7467 69.4793 14.992H73.0793Z" fill="inherit"/>
						</svg>
					</a>
				</div>
				<div class="main-canvas-wrap" >
					<canvas id="c_product_canvas_bg" class="canvas-layer"
					        width="<?php echo $real_product_width; ?>"
					        height="<?php echo $real_product_height; ?>" >
						Your browser does not support the HTML5 canvas tag.
					</canvas>
					<canvas id="c_product_canvas" class="canvas-layer"
					        width="<?php echo $canvas_width_print; ?>"
					        height="<?php echo $canvas_height_print; ?>"
					        data-default_img="<?php echo $main_customize_img; ?>"
					        data-real_width="<?php echo $real_product_width; ?>"
					        data-real_height="<?php echo $real_product_height; ?>"
					        data-print_width="<?php echo $canvas_width_print; ?>"
					        data-print_height="<?php echo $canvas_height_print; ?>"
					        data-scale_ratio="<?php echo $scaleRatio; ?>"
						<?php echo $r_rect_obg ? "data-r_acoords='".strval($r_rect_obg)."'" : ''; ?>
					>Your browser does not support the HTML5 canvas tag.</canvas>
				</div>
				<div class="attribute-bottom-navigation">
					<a href="#" class="attr-empty-canvas-data">
						<svg width="28" height="21" viewBox="0 0 28 21" fill="#C8C8C8" xmlns="http://www.w3.org/2000/svg">
							<path fill-rule="evenodd" clip-rule="evenodd" d="M13.9679 2.30762C15.056 2.30618 16.1336 2.51968 17.139 2.93586C18.1443 3.35203 19.0575 3.9627 19.8262 4.73278C20.2164 5.12366 20.8495 5.12424 21.2404 4.73407C21.6313 4.3439 21.6319 3.71074 21.2417 3.31986C20.287 2.36335 19.1527 1.60486 17.904 1.08794C16.6554 0.57107 15.317 0.305892 13.9657 0.307626L13.9663 0.307625L13.9666 1.30763L13.9653 0.307626L13.9657 0.307626C12.5161 0.308162 11.0829 0.614945 9.76006 1.20788C8.43704 1.80089 7.25424 2.66675 6.28916 3.74872C5.32409 4.8307 4.59851 6.10437 4.15996 7.4863C4.02827 7.90127 3.92336 8.32319 3.84547 8.74947L2.69079 7.17739C2.36386 6.73227 1.73799 6.63646 1.29287 6.96339C0.847745 7.29033 0.751936 7.9162 1.07887 8.36132L3.91574 12.2237C4.11896 12.5165 4.47255 12.691 4.85145 12.6477C5.06392 12.6234 5.25319 12.5342 5.40173 12.4022L8.99522 9.33797C9.41546 8.97962 9.46564 8.34844 9.10729 7.9282C8.74894 7.50796 8.11777 7.45778 7.69752 7.81613L5.75474 9.47276C5.81883 9.00546 5.92284 8.54324 6.06627 8.09126C6.41959 6.97788 7.00417 5.95172 7.7817 5.08001C8.55924 4.2083 9.51218 3.5107 10.5781 3.03293C11.644 2.55516 12.7988 2.30799 13.9669 2.30763L13.9679 2.30762ZM22.9949 8.45929C23.0569 8.44731 23.1203 8.44118 23.1841 8.44116C23.3001 8.44102 23.4126 8.46105 23.5175 8.49827C23.7048 8.56442 23.8699 8.68551 23.9897 8.8483L26.9213 12.8302C27.2487 13.275 27.1536 13.901 26.7088 14.2284C26.2641 14.5558 25.6381 14.4607 25.3107 14.016L24.1014 12.3734C23.9113 13.4569 23.5476 14.5094 23.0182 15.4888C21.9984 17.3751 20.4149 18.8957 18.4887 19.8381C16.5626 20.7805 14.3902 21.0975 12.275 20.7449C10.1599 20.3923 8.20778 19.3878 6.69148 17.8716C6.30094 17.481 6.30092 16.8479 6.69143 16.4573C7.08194 16.0668 7.71511 16.0668 8.10564 16.4573C9.32721 17.6788 10.8999 18.4881 12.6039 18.7721C14.3079 19.0562 16.058 18.8008 17.6098 18.0416C19.1615 17.2824 20.4373 16.0573 21.2588 14.5377C21.7409 13.6459 22.0524 12.6788 22.1842 11.6855L20.3231 13.359C19.9124 13.7283 19.2801 13.6947 18.9108 13.284C18.5416 12.8734 18.5751 12.2411 18.9858 11.8718L22.4996 8.71215C22.6336 8.58619 22.8032 8.49603 22.9949 8.45929Z" fill="inherit"/>
						</svg>
					</a>
				</div>
			</div>
			<div class="right-side">
				<ul class="attribute-navigation">
					<?php if( array_key_exists('pa_peripherals', $product_attributes) ) : ?>
						<li>
							<a href="#peripherals"><?php esc_html_e('Peripherals', kt_textdomain); ?></a>
						</li>
					<?php endif; ?>
					<?php if( array_key_exists('pa_background', $product_attributes) ) : ?>
						<li>
							<a href="#background"><?php esc_html_e('Background', kt_textdomain); ?></a>
						</li>
					<?php endif; ?>
					<?php if( array_key_exists('pa_graphic', $product_attributes) ) : ?>
						<li>
							<a href="#graphic"><?php esc_html_e('Graphic', kt_textdomain); ?></a>
						</li>
					<?php endif; ?>
					<li class="last">
						<a href="#text"><?php esc_html_e('Text', kt_textdomain); ?></a>
					</li>
				</ul>
				<div class="main-terms-atts">
					<?php if( array_key_exists('pa_peripherals', $product_attributes) ) : ?>
						<div id="peripherals" class="attribute-block is_active">
							<?php ktwc_generate_html_prod_attr_acf( 'pa_peripherals', $product_attributes ); ?>
						</div>
					<?php endif; ?>
					<?php if( array_key_exists('pa_background', $product_attributes) ) : ?>
						<div id="background" class="attribute-block">
							<?php ktwc_generate_html_prod_attr_acf( 'pa_background', $product_attributes ); ?>
						</div>
					<?php endif; ?>
					<?php if( array_key_exists('pa_graphic', $product_attributes) ) : ?>
						<div id="graphic" class="attribute-block">
							<?php ktwc_generate_html_prod_attr_acf( 'pa_graphic', $product_attributes ); ?>
						</div>
					<?php endif; ?>
				  <div id="text" class="attribute-block">
						<form id="customize_product_text" action="customize_product_text" method="POST">
							<div class="form-row">
								<textarea placeholder="<?php echo __('Enter some text', kt_textdomain); ?>"
								          name="customize_product_text"
								          id="customize_product_text"
								         ></textarea>
							</div>
							<button type="submit" value="<?php esc_html_e('Add text', kt_textdomain); ?>" class="woo-btn">
								<?php esc_html_e('Add text', kt_textdomain); ?>
							</button>
						</form>
					</div>
				</div>
				<div class="main-terms-atts-nav">
					<a href="#" class="woo-btn woo-btn--back ">
						<?php echo __('Back', kt_textdomain); ?>
					</a>
					<a href="#" class="kt-btn kt-btn--next">
						<?php echo __('Next', kt_textdomain); ?>
					</a>
				</div>
			</div>
		</div>

	</div>

</article>

<?php do_action( 'woocommerce_after_single_product' ); ?>




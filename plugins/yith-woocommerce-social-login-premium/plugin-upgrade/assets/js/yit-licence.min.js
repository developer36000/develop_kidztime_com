(function(b){var g=b("body"),u=b(document),d=b("#yith-license-activation"),h=b(d).find(".error-message.email"),f=b(d).find(".error-message.license-key"),p=d.find(".user-email"),t=d.find(".licence-key");b.yith_license_animation=function(a,e,c){var k=b("#licence-check-section-wrapper"),d=b("#no-license-enabled-message"),l=b("#yith-no-license-to-enabled-message"),m=b("#yith-license-from-wrapper");"beforeSend"==c?(a.animate({opacity:.4},100),e.addClass("show")):"afterSend"==c?(a.animate({opacity:1},100),
    e.removeClass("show")):"removeLine"==c?(c=a.parent("tbody"),c=c.find("tr"),0===b("#yith-products-list").find("option").length&&(m.fadeIn(),l.fadeOut()),1==c.length?(d.fadeIn(),k.fadeOut(),a.remove()):a.fadeOut(),e.removeClass("show")):"addLine"==c&&(c=a.parent("tbody"),c=c.find("tr"),1===b("#yith-products-list").find("option").length&&(m.fadeOut(),l.fadeIn()),1==c.length&&(a.show(),a=k,d.fadeOut()),a.fadeIn(),e.removeClass("show"))};var A=function(a){a.off("click").on("click",function(a,c){a.preventDefault();
    b(this);var e=b("#yith-license-activation"),d=b("#yith-products-list"),l=d.find("option:selected"),m=l.data("init"),x=l.data("marketplace"),n=b("#yith-licence-notice-wrapper"),y=b("#yith-licence-notice"),v=null,q=b("#products-to-active").find(".spinner"),w=!1,z=b("#licence-check-update");b("#product_init").val(m);b("#marketplace").val(x);v=e.serialize();h.add(f).empty();h.add(f).removeClass("visible");email_check=g.find("input.licence-key").trigger("focusout");license_key_check=g.find("input.user-email").trigger("focusout");
    if(email_check.hasClass("error")||license_key_check.hasClass("error"))w=!0;!1===w?jQuery.ajax({type:"POST",url:"undefined"!=typeof ajaxurl?ajaxurl:yith_ajax.url,data:v,beforeSend:function(){b.yith_license_animation(e,q,"beforeSend")},success:function(a){b.yith_license_animation(e,q,"afterSend");if(!0===a.activated){var c=b("#yith-enabled-license"),k=b(a.template);c.find("tbody").prepend(k);k.hide();b("html, body").animate({scrollTop:z.offset().top},500).promise().done(function(){p.add(t).attr("value",
            "");l.remove();product_count=e.data("count");console.log(product_count);e.removeClass("count-"+product_count);product_count=1*product_count-1;e.data("count",product_count).addClass("count-"+product_count);1==product_count||0==product_count?(d.attr("disabled",!0),b(".yith-select-plugin").text(licence_message.choose_the_plugin_singular)):(d.attr("disabled",!1),b(".yith-select-plugin").text(licence_message.choose_the_plugin_plural))});b.yith_license_animation(k,q,"addLine");y.find("p.yith-licence-notice-message").html("#"+
            a.code+": "+a.activation_message);n.fadeIn();r()}else!1!==a?(f.text("#"+a.code+": "+a.error),h.add(f).addClass("visible")):(f.text(licence_message.server),f.addClass("visible")),e.addClass("error");"undefined"!==typeof a.debug&&console.log(a.debug)}}):b.yith_license_animation(e,q,"afterSend")})},B=function(a){a.off("click").on("click",function(a){a.preventDefault();b(this);var c=b("#licence-check-update"),e=b("#yith-enabled-license");a=c.serialize();jQuery.ajax({type:"POST",url:ajaxurl,data:a,beforeSend:function(){b.yith_license_animation(e,
        c.find("div.spinner"),"beforeSend")},success:function(a){b(".product-licence-activation").empty().replaceWith(a.template)},complete:function(){r()}})})},C=function(a){a.off("click").on("click",function(a){a.preventDefault();if(1==(1==script_info.is_debug?!0:confirm(licence_message.are_you_sure))){var c=b(this),e=c.parent("td").parent("tr");a=c.data("product-init");var f=c.data("product-id"),l=c.data("action"),m=b("#yith-licence-notice-wrapper"),g=b("#yith-licence-notice"),h=b("#activated-products").find(".spinner");
    jQuery.ajax({type:"POST",url:ajaxurl,data:{action:l,product_init:a,product_id:f},beforeSend:function(){b.yith_license_animation(e,h,"beforeSend")},success:function(a){if(0==a)g.find("p.yith-licence-notice-message").html(licence_message.server),m.fadeIn();else{if(0==a.activated){b.yith_license_animation(e,h,"removeLine");var k=b("#yith-products-list"),f=c.data("textdomain"),l=c.data("product-init"),n=c.data("marketplace"),p=c.data("displayname");f=b('<option data-textdomain="'+f+'" data-init="'+l+
            '" data-marketplace="'+n+'">'+p+"</option>");k.append(f);product_count=d.data("count");d.removeClass("count-"+product_count);product_count=1*product_count+1;d.data("count",product_count).addClass("count-"+product_count);1==product_count||0==product_count?(products_list.attr("disabled",!0),b(".yith-select-plugin").text(licence_message.choose_the_plugin_singular)):(products_list.attr("disabled",!1),b(".yith-select-plugin").text(licence_message.choose_the_plugin_plural));r()}"undefined"!=typeof a.error&&
        (g.find("p.yith-licence-notice-message").html(a.error),m.fadeIn())}}})}})},D=function(a){a.off("click").on("click",function(a){a.preventDefault();if(1==script_info.is_debug||confirm(licence_message.are_you_sure)){var c=b(this),e=b("#yith-expired-license-count"),d=1*e.data("count"),f=c.parent("td").parent("tr"),g=d-1;a=c.data("product-init");var h=c.data("product-id");c=c.data("action");var n=b("#activated-products").find(".spinner");jQuery.ajax({type:"POST",url:ajaxurl,data:{action:c,product_init:a,
        product_id:h,force_delete:!0},beforeSend:function(){b.yith_license_animation(f,n,"beforeSend")},success:function(a){b.yith_license_animation(f,n,999==a.code?"removeLine":"afterSend");e.removeClass("count-"+d).addClass("count-"+g);e.data("count",g);e.find(".expired-count").empty().text(g)}})}})};g.on("focusout","input.user-email",function(){var a=d.find(".user-email"),b=a.val().trim();a.val(b);(a=""===b)||(a=!(new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i)).test(b));
    a&&(h.text(licence_message.error.replace("%field%",licence_message.email)),h.addClass("visible"),p.addClass("require error"))}).on("focusout","input.licence-key",function(){var a=d.find(".licence-key"),b=a.val().trim();a.val(b);(a=""===b)||(a=!(new RegExp(/^[a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}$/g)).test(b));a&&(f.text(licence_message.error.replace("%field%",licence_message.license_key)),f.addClass("visible"),t.addClass("require error"))});var r=function(){var a=
    b(".licence-activation"),e=b(".licence-check"),c=b(".licence-deactive"),k=b(".remove-expired-plugin");g=b("body");u=b(document);d=b("#yith-license-activation");h=d.find(".error-message.email");f=d.find(".error-message.license-key");p=d.find(".user-email");t=d.find(".licence-key");products_list=b("#yith-products-list");product_count=d.data("count");A(a);B(e);C(c);D(k);g.trigger("wc-enhanced-select-init")};r();g.on("click",".yit-changelog-button",function(a){b("#TB_window").remove()});g.on("focusin",
    "input.user-email, input.licence-key",function(){var a=b(this);a.removeClass("require").removeClass("error");a.hasClass("user-email")&&h.text("");a.hasClass("licence-key")&&f.text("")});u.on("ready",function(){var a=g.find("input.user-email"),b=g.find("input.licence-key");""!=a.val()&&a.trigger("focusout");""!=b.val()&&b.trigger("focusout")})})(jQuery);